<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>个人站点：Mysql 5.6 内存占用配置 | W41ter’s Bistro</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="个人站点：Mysql 5.6 内存占用配置" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="前两天刚把服务器部署上，今天就出现了异常。在 App 上看是服务器直接宕机。原本以为仅仅是服务端挂了，在服务器上使用 ps aux | grep java 发现进程还在，只是不服务了。打开 log 发现 Java run out of memory，导致无法创建新的线程。 使用 top -o %MEM 查看，java 占用近 200M，mysql 占用近 500 M。因为是个人用的小服务器，只有 1G 内存，吃紧得很。既然 mysql 占用了最多的内存，就让它吐出一点好了。 一开始猜测是 InnoDB 缓冲区过大，不过在 /etc/mysql/my.cnf 中发现配置的缓存已经非常小了。后来在网上发现是因为 Mysql 5.6 版本默认 GA 配置过大，导致初始需要近 400M 空间。通过下面配置，直接讲内存降到 100M 以下： performance_schema_max_table_instances=400 table_definition_cache=400 table_open_cache=256 参数意义： performance_schema_max_table_instances The maximum number of instrumented table objects 检测的表对象的最大数目。 table_definition_cache The number of table definitions (from .frm files) that can be stored in the definition cache. If you use a large number of tables, you can create a large table definition cache to speed up opening of tables. The table definition cache takes less space and does not use file descriptors, unlike the normal table cache. The minimum and default values are both 400. 缓存 frm 文件 table_open_cache The number of open tables for all threads. Increasing this value increases the number of file descriptors that mysqld requires. table_open_cache 指的是缓存数据文件的描述符(Linux/Unix)相关信息 在 5.6 中的默认配置： performance_schema_max_table_instances 12500 table_definition_cache 1400 table_open_cache 2000 References: 解决 Mysql 内存占用巨大问题 MySQL 5.6内存占用过高解决方案 linux 下mysql内存占用过高" />
<meta property="og:description" content="前两天刚把服务器部署上，今天就出现了异常。在 App 上看是服务器直接宕机。原本以为仅仅是服务端挂了，在服务器上使用 ps aux | grep java 发现进程还在，只是不服务了。打开 log 发现 Java run out of memory，导致无法创建新的线程。 使用 top -o %MEM 查看，java 占用近 200M，mysql 占用近 500 M。因为是个人用的小服务器，只有 1G 内存，吃紧得很。既然 mysql 占用了最多的内存，就让它吐出一点好了。 一开始猜测是 InnoDB 缓冲区过大，不过在 /etc/mysql/my.cnf 中发现配置的缓存已经非常小了。后来在网上发现是因为 Mysql 5.6 版本默认 GA 配置过大，导致初始需要近 400M 空间。通过下面配置，直接讲内存降到 100M 以下： performance_schema_max_table_instances=400 table_definition_cache=400 table_open_cache=256 参数意义： performance_schema_max_table_instances The maximum number of instrumented table objects 检测的表对象的最大数目。 table_definition_cache The number of table definitions (from .frm files) that can be stored in the definition cache. If you use a large number of tables, you can create a large table definition cache to speed up opening of tables. The table definition cache takes less space and does not use file descriptors, unlike the normal table cache. The minimum and default values are both 400. 缓存 frm 文件 table_open_cache The number of open tables for all threads. Increasing this value increases the number of file descriptors that mysqld requires. table_open_cache 指的是缓存数据文件的描述符(Linux/Unix)相关信息 在 5.6 中的默认配置： performance_schema_max_table_instances 12500 table_definition_cache 1400 table_open_cache 2000 References: 解决 Mysql 内存占用巨大问题 MySQL 5.6内存占用过高解决方案 linux 下mysql内存占用过高" />
<link rel="canonical" href="/linux/%E6%9C%8D%E5%8A%A1%E5%99%A8/2017/09/08/%E4%B8%AA%E4%BA%BA%E7%AB%99%E7%82%B9-Mysql-5-6-%E5%86%85%E5%AD%98%E5%8D%A0%E7%94%A8%E9%85%8D%E7%BD%AE.html" />
<meta property="og:url" content="/linux/%E6%9C%8D%E5%8A%A1%E5%99%A8/2017/09/08/%E4%B8%AA%E4%BA%BA%E7%AB%99%E7%82%B9-Mysql-5-6-%E5%86%85%E5%AD%98%E5%8D%A0%E7%94%A8%E9%85%8D%E7%BD%AE.html" />
<meta property="og:site_name" content="W41ter’s Bistro" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-09-08T06:58:09+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="个人站点：Mysql 5.6 内存占用配置" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2017-09-08T06:58:09+08:00","datePublished":"2017-09-08T06:58:09+08:00","description":"前两天刚把服务器部署上，今天就出现了异常。在 App 上看是服务器直接宕机。原本以为仅仅是服务端挂了，在服务器上使用 ps aux | grep java 发现进程还在，只是不服务了。打开 log 发现 Java run out of memory，导致无法创建新的线程。 使用 top -o %MEM 查看，java 占用近 200M，mysql 占用近 500 M。因为是个人用的小服务器，只有 1G 内存，吃紧得很。既然 mysql 占用了最多的内存，就让它吐出一点好了。 一开始猜测是 InnoDB 缓冲区过大，不过在 /etc/mysql/my.cnf 中发现配置的缓存已经非常小了。后来在网上发现是因为 Mysql 5.6 版本默认 GA 配置过大，导致初始需要近 400M 空间。通过下面配置，直接讲内存降到 100M 以下： performance_schema_max_table_instances=400 table_definition_cache=400 table_open_cache=256 参数意义： performance_schema_max_table_instances The maximum number of instrumented table objects 检测的表对象的最大数目。 table_definition_cache The number of table definitions (from .frm files) that can be stored in the definition cache. If you use a large number of tables, you can create a large table definition cache to speed up opening of tables. The table definition cache takes less space and does not use file descriptors, unlike the normal table cache. The minimum and default values are both 400. 缓存 frm 文件 table_open_cache The number of open tables for all threads. Increasing this value increases the number of file descriptors that mysqld requires. table_open_cache 指的是缓存数据文件的描述符(Linux/Unix)相关信息 在 5.6 中的默认配置： performance_schema_max_table_instances 12500 table_definition_cache 1400 table_open_cache 2000 References: 解决 Mysql 内存占用巨大问题 MySQL 5.6内存占用过高解决方案 linux 下mysql内存占用过高","headline":"个人站点：Mysql 5.6 内存占用配置","mainEntityOfPage":{"@type":"WebPage","@id":"/linux/%E6%9C%8D%E5%8A%A1%E5%99%A8/2017/09/08/%E4%B8%AA%E4%BA%BA%E7%AB%99%E7%82%B9-Mysql-5-6-%E5%86%85%E5%AD%98%E5%8D%A0%E7%94%A8%E9%85%8D%E7%BD%AE.html"},"url":"/linux/%E6%9C%8D%E5%8A%A1%E5%99%A8/2017/09/08/%E4%B8%AA%E4%BA%BA%E7%AB%99%E7%82%B9-Mysql-5-6-%E5%86%85%E5%AD%98%E5%8D%A0%E7%94%A8%E9%85%8D%E7%BD%AE.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="W41ter's Bistro" /><!-- for mathjax support -->
  
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">W41ter&#39;s Bistro</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">个人站点：Mysql 5.6 内存占用配置</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2017-09-08T06:58:09+08:00" itemprop="datePublished">Sep 8, 2017
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>前两天刚把服务器部署上，今天就出现了异常。在 App 上看是服务器直接宕机。原本以为仅仅是服务端挂了，在服务器上使用 <code class="language-plaintext highlighter-rouge">ps aux | grep java</code> 发现进程还在，只是不服务了。打开 log 发现 Java run out of memory，导致无法创建新的线程。</p>

<p>使用 <code class="language-plaintext highlighter-rouge">top -o %MEM</code> 查看，java 占用近 200M，mysql 占用近 500 M。因为是个人用的小服务器，只有 1G 内存，吃紧得很。既然 mysql 占用了最多的内存，就让它吐出一点好了。</p>

<p>一开始猜测是 InnoDB 缓冲区过大，不过在 <code class="language-plaintext highlighter-rouge">/etc/mysql/my.cnf</code> 中发现配置的缓存已经非常小了。后来在网上发现是因为 Mysql 5.6 版本默认 GA 配置过大，导致初始需要近 400M 空间。通过下面配置，直接讲内存降到 100M 以下：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>performance_schema_max_table_instances=400
table_definition_cache=400
table_open_cache=256
</code></pre></div></div>

<p>参数意义：</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">performance_schema_max_table_instances</code></li>
</ul>

<p>The maximum number of instrumented table objects</p>

<p>检测的表对象的最大数目。</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">table_definition_cache</code></li>
</ul>

<p>The number of table definitions (from .frm files) that can be stored in the definition cache. If you use a large number of tables, you can create a large table definition cache to speed up opening of tables. The table definition cache takes less space and does not use file descriptors, unlike the normal table cache. The minimum and default values are both 400.</p>

<p>缓存 <code class="language-plaintext highlighter-rouge">frm</code> 文件</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">table_open_cache</code>
The number of open tables for all threads. Increasing this value increases the number of file descriptors that mysqld requires.</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">table_open_cache</code> 指的是缓存数据文件的描述符(Linux/Unix)相关信息</p>

<p>在 5.6 中的默认配置：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>performance_schema_max_table_instances 12500
table_definition_cache 1400
table_open_cache 2000
</code></pre></div></div>

<p><em>References:</em></p>

<ul>
  <li><a href="http://www.cnblogs.com/yum777/p/6554901.html">解决 Mysql 内存占用巨大问题</a></li>
  <li><a href="http://blog.csdn.net/wulantian/article/details/41119755">MySQL 5.6内存占用过高解决方案</a></li>
  <li><a href="http://bbs.csdn.net/topics/390724779">linux 下mysql内存占用过高</a></li>
</ul>

  </div><a class="u-url" href="/linux/%E6%9C%8D%E5%8A%A1%E5%99%A8/2017/09/08/%E4%B8%AA%E4%BA%BA%E7%AB%99%E7%82%B9-Mysql-5-6-%E5%86%85%E5%AD%98%E5%8D%A0%E7%94%A8%E9%85%8D%E7%BD%AE.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">W41ter&#39;s Bistro</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">W41ter&#39;s Bistro</li><li><a class="u-email" href="mailto:w41ter.l@gmail.com">w41ter.l@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/w41ter"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">w41ter</span></a></li><li><a href="https://www.twitter.com/WalterM56697798"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">WalterM56697798</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Focus on distributed storage system, compiler.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
